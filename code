devices.forEach((d, i) => {
  const row = deviceTableBody.insertRow();
  // existing row population code...
});

// ✅ Add this block at the END of populateDeviceTable()

const cityFilter = document.getElementById('cityFilter');
if (cityFilter) {
  const uniqueCities = [...new Set(devices.map(dev => dev.city).filter(Boolean))].sort();
  cityFilter.innerHTML = '<option value="all">All Cities</option>';
  uniqueCities.forEach(city => {
    const option = document.createElement('option');
    option.value = city;
    option.textContent = city;
    cityFilter.appendChild(option);
  });

  // ✅ Add change event listener only once
  if (!cityFilter.dataset.listenerAdded) {
    cityFilter.addEventListener('change', filterData);
    cityFilter.dataset.listenerAdded = 'true';
  }
}