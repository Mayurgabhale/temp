function filterData() {
  const searchValue = document.getElementById('searchBox')?.value.toLowerCase() || "";
  const selectedCity = document.getElementById('cityFilter')?.value.toLowerCase().trim();
  const selectedDeviceType = document.getElementById('device-type')?.value.toLowerCase().trim();
  const selectedRemark = document.getElementById('remark-filter')?.value.toLowerCase().trim();

  const rows = document.querySelectorAll('#device-table tbody tr');
  let visibleCount = 0;

  rows.forEach(row => {
    const ip = row.cells[1].textContent.trim();
    const name = row.cells[2].textContent.toLowerCase();
    const category = row.cells[3].textContent.toLowerCase().trim();
    const region = row.cells[4].textContent.toLowerCase().trim();
    const city = row.cells[5].textContent.toLowerCase().trim();
    const remark = document.getElementById(`remark-${sanitizeId(ip)}`)?.innerText.toLowerCase().trim() || "";

    const matchesSearch = [ip, name, category, region, city].some(text =>
      text.includes(searchValue)
    );

    const matchesCity = !selectedCity || selectedCity === "all" || city === selectedCity;
    const matchesType = selectedDeviceType === "all" || category === selectedDeviceType;
    const matchesRemark = selectedRemark === "all" || remark.includes(selectedRemark);

    const shouldDisplay = matchesSearch && matchesCity && matchesType && matchesRemark;
    row.style.display = shouldDisplay ? "" : "none";
    if (shouldDisplay) visibleCount++;
  });

  updateDisplayedDeviceCount(visibleCount);
}