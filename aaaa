const partitionRows = useMemo(() => {
  if (!summaryEntry) return [];

  const rows = Object.entries(summaryEntry.partitions)
    .filter(([key]) => {
      if (!backendFilterKey) return true;
      
      // Normalize keys for comparison
      const normalizedKey = key.replace(' City', '');
      const normalizedFilter = backendFilterKey.replace(' City', '');
      
      return normalizedKey === normalizedFilter;
    })
    .map(([key, vals]) => {
      // Find matching frontend code
      const feCode = Object.entries(apacForwardKey).find(
        ([code, beKey]) => beKey === key || `${beKey} City` === key
      )?.[0];

      const display = feCode ? apacPartitionDisplay[feCode] : null;

      return {
        country: display?.country || 'Unknown',
        city: display?.city || key.replace(' City', ''),
        employee: vals.Employee ?? vals.EmployeeCount ?? 0,
        contractor: vals.Contractor ?? vals.ContractorCount ?? 0,
        total: vals.total ?? 0,
      };
    });

  // DEBUG LOGS - Add these lines
  console.log('--- DEBUG PARTITION DATA ---');
  console.log('Backend filter:', backendFilterKey);
  console.log('Available partitions:', Object.keys(summaryEntry.partitions));
  console.log('Filtered results:', rows);
  console.log('----------------------------');

  return rows;
}, [summaryEntry, backendFilterKey]);






useEffect(() => {
  setLoading(true);
  fetchHistory(decodedPartition)
    .then(json => {
      setData(json);
      // DEBUG LOG - Add this line
      console.log('Initial data loaded:', json);
    })
    .finally(() => setLoading(false));
}, [decodedPartition]);