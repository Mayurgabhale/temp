deviceList.sort((a, b) => {
    const now = Date.now();

    const aLast = a.deviceHistory[a.deviceHistory.length - 1];
    const bLast = b.deviceHistory[b.deviceHistory.length - 1];

    const aIsOffline = aLast?.status === "Offline";
    const bIsOffline = bLast?.status === "Offline";

    const aOfflineDuration = aIsOffline ? (now - new Date(aLast.timestamp)) / 1000 : 0;
    const bOfflineDuration = bIsOffline ? (now - new Date(bLast.timestamp)) / 1000 : 0;

    const aShouldPrioritize = aIsOffline && aOfflineDuration >= 300;
    const bShouldPrioritize = bIsOffline && bOfflineDuration >= 300;

    if (aShouldPrioritize && !bShouldPrioritize) return -1;
    if (!aShouldPrioritize && bShouldPrioritize) return 1;

    // Fallback: more downtime count goes up
    return b.downtimeCount - a.downtimeCount;
});