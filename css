// ✅ UseMemo ALWAYS runs
const floorEntries = useMemo(() => {
  if (!liveSummary || !liveSummary.realtime?.[partition]) return [];

  const liveFloors = liveSummary.realtime[partition].floors || {};

  return Object.entries(liveFloors).map(([floor, cnt]) => {
    const name = floor.trim();
    let capacity = buildingCapacities[name];

    if (capacity == null) {
      capacity = seatCapacities[partition] ?? 0;
    }

    const pct = capacity ? Math.round((cnt / capacity) * 100) : 0;

    return {
      name,
      Headcount: cnt,
      Capacity: capacity,
      breakdown: {
        Headcount: cnt,
        'Total Seat': capacity,
        Usage: `${pct}%`,
      },
    };
  });
}, [liveSummary, partition]);

// ✅ After all hooks, now safe to return
if (!history?.summaryByDate || !Array.isArray(history.summaryByDate) || history.summaryByDate.length === 0) {
  return <LoadingSpinner />;
}