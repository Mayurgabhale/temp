let tableRows = [];
let lastOfflineTimestamp = null;
let lastOfflineIndex = null;

history.forEach((entry, index) => {
    let entryDate = new Date(entry.timestamp);
    let formattedDate = entryDate.toLocaleDateString();
    let formattedTime = entryDate.toLocaleTimeString();
    let formattedDay = entryDate.toLocaleString('en-US', { weekday: 'long' });

    // Default values
    let row = {
        srNo: index + 1,
        date: formattedDate,
        day: formattedDay,
        time: formattedTime,
        status: entry.status,
        duration: "-"
    };

    if (entry.status === "Offline") {
        lastOfflineTimestamp = entry.timestamp;
        lastOfflineIndex = tableRows.length; // Store index where we might update duration
    } else if (entry.status === "Online" && lastOfflineTimestamp !== null) {
        const offlineStart = new Date(lastOfflineTimestamp).getTime();
        const onlineTime = new Date(entry.timestamp).getTime();
        const durationSec = (onlineTime - offlineStart) / 1000;

        if (durationSec >= 300 && lastOfflineIndex !== null) {
            tableRows[lastOfflineIndex].duration = formatDuration(durationSec);
        }

        // Reset
        lastOfflineTimestamp = null;
        lastOfflineIndex = null;
    }

    tableRows.push(row);
});





tableRows.forEach(row => {
    tableHTML += `
        <tr>
            <td>${row.srNo}</td>
            <td>${row.date}</td>
            <td>${row.day}</td>
            <td>${row.time}</td>
            <td style="color: ${row.status === "Online" ? 'green' : 'red'};">${row.status}</td>
            <td>${row.duration}</td>
        </tr>
    `;
});
