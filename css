const handlePartitionChange = (newCode) => {
  if (!newCode) {
    navigate('/');
    return;
  }

  // If current path has /history or /details, preserve it
  const suffix = (extraSegments.includes('history') || extraSegments.includes('details'))
    ? `/${extraSegments.join('/')}`
    : '';

  // Navigate to the correct route
  navigate(`/partition/${encodeURIComponent(newCode)}${suffix}`);
};