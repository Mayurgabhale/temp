
const validDowntimeDurationSec = sumValidDowntimeDuration(device.history, device.category);
const downtimeDuration = formatDuration(validDowntimeDurationSec);
downtimeCell.innerHTML = downtimeDuration;





function countValidDowntimes(history, category) {
    let count = 0;
    let lastOffline = null;

    for (let i = 0; i < history.length; i++) {
        const entry = history[i];

        if (entry.status === "Offline") {
            lastOffline = entry;
        } else if (entry.status === "Online" && lastOffline) {
            const offlineTime = new Date(lastOffline.timestamp);
            const onlineTime = new Date(entry.timestamp);
            const durationSec = (onlineTime - offlineTime) / 1000;

            if (category === "SERVER" || durationSec >= 300) {
                count++;
            }
            lastOffline = null;
        }
    }

    // If still offline now
    if (lastOffline) {
        const offlineTime = new Date(lastOffline.timestamp);
        const now = new Date();
        const durationSec = (now - offlineTime) / 1000;
        if (category === "SERVER" || durationSec >= 300) {
            count++;
        }
    }

    return count;
}

function sumValidDowntimeDuration(history, category) {
    let total = 0;
    let lastOffline = null;

    for (let i = 0; i < history.length; i++) {
        const entry = history[i];

        if (entry.status === "Offline") {
            lastOffline = entry;
        } else if (entry.status === "Online" && lastOffline) {
            const offlineTime = new Date(lastOffline.timestamp);
            const onlineTime = new Date(entry.timestamp);
            const durationSec = (onlineTime - offlineTime) / 1000;

            if (category === "SERVER" || durationSec >= 300) {
                total += durationSec;
            }
            lastOffline = null;
        }
    }

    if (lastOffline) {
        const offlineTime = new Date(lastOffline.timestamp);
        const now = new Date();
        const durationSec = (now - offlineTime) / 1000;
        if (category === "SERVER" || durationSec >= 300) {
            total += durationSec;
        }
    }

    return total;
}